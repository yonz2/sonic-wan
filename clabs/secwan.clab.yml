# Author: Yonz / Net-Innovate Solutions GmbH
# License: The Unlicense
# Description: Defines a simple site with a SONiC core switch actinf as a policy based router, and several clients.
name: secwan

mgmt:
  network: clab-net
  ipv4-subnet: 192.168.250.0/24

topology:
  nodes:
    # ----------------------------------------------------------------
    # Core Switch and Clients
    # ----------------------------------------------------------------
    core1:
      kind: sonic-vm
      image: vrnetlab/sonic_secure_wan:latest
      group: "Site 1"

    linux1:
      kind: linux
      image: linux-client:full
      group: "Site 1"
      exec:
        - "ip addr add 192.168.10.11/24 dev eth1"
        - "ip route replace default via 192.168.10.1" # Add default gateway

    iot1:
      kind: linux
      image: iot-client:full
      group: "Site 1"
      exec:
        - "ip addr add 192.168.30.11/24 dev eth1"
        - "ip route replace default via 192.168.30.1" # Add default gateway
    
    iot2:
      kind: linux
      image: iot-client:full
      group: "Site 1"
      exec:
        - "ip addr add 192.168.30.12/24 dev eth1"
        - "ip route replace default via 192.168.30.1" # Add default gateway

  links:
    # Uplink: router's eth1 connects to core1's eth1, which maps to Ethernet0 in SONiC
    - endpoints: ["wan-node1:eth1", "core1:eth1"]

    # Client connections to Core Switch
    # To connect to Ethernet12 in SONiC, we must use eth4 in the topology file
    - endpoints: ["core1:eth4", "linux1:eth1"] # VLAN 10
    
    # To connect to Ethernet24 in SONiC, we must use eth7
    - endpoints: ["core1:eth7", "iot1:eth1"] # VLAN 30
    
    # To connect to Ethernet28 in SONiC (since 25 is not possible), we use eth8
    - endpoints: ["core1:eth8", "iot2:eth1"] # VLAN 30
